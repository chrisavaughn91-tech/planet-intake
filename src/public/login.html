<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Planet Lead Pull — Sign in to Run</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark light; }
    body{margin:0;background:#0b0f14;color:#e7eef7;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{min-height:100svh;display:grid;place-items:center;padding:32px}
    .card{width:min(740px,92vw);background:#0f1620;border:1px solid #1f2a37;border-radius:16px;padding:28px 28px 22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 12px;font-size:20px;font-weight:700}
    .note{opacity:.75;font-size:13px;margin-top:-2px;margin-bottom:18px}
    label{display:block;font-size:13px;margin:14px 0 6px}
    input{width:100%;padding:10px 12px;border:1px solid #2a3a4d;border-radius:9px;background:#0b121a;color:#e7eef7;outline:none}
    input:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:14px}
    .left{display:flex;gap:10px;align-items:center}
    .btn{border:1px solid #2a3a4d;background:#111a24;color:#e7eef7;border-radius:10px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:#2563eb;border-color:#2563eb}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .hint{font-size:12px;opacity:.65;margin-top:6px}
    .check{display:flex;gap:8px;align-items:center;font-size:13px;opacity:.9;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Planet Lead Pull — Sign in to Run</h1>
      <div class="note">We’ll use these credentials <b>once</b> for this run. We do not store them.</div>

      <label for="username">Username</label>
      <input id="username" autocomplete="username" />

      <label for="password">Password</label>
      <input id="password" type="password" autocomplete="current-password" />

      <label for="email">Email (for tagging this run)</label>
      <input id="email" type="email" placeholder="you@example.com" />

      <label for="max">Max leads (optional)</label>
      <input id="max" inputmode="numeric" pattern="[0-9]*" placeholder="e.g. 200" />

      <div class="check">
        <input id="autorun" type="checkbox" checked />
        <label for="autorun">Auto-start scrape</label>
      </div>

      <div class="row">
        <div class="left">
          <button id="demo" class="btn">Quick Demo</button>
        </div>
        <div class="right">
          <button id="run" class="btn primary">Run my scrape →</button>
        </div>
      </div>

      <div class="hint" id="hint"></div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const hint = $("hint");

    function say(msg, kind="") {
      hint.textContent = msg;
      hint.style.color = kind === "err" ? "#fca5a5" : "#9ca3af";
    }

    $("demo").addEventListener("click", () => {
      $("username").value = "demo-user";
      $("password").value = "demo-pass";
      $("email").value    = "demo@example.com";
      $("max").value      = "50";
      say("Demo fields filled. Click “Run my scrape →” to start.");
    });

    $("run").addEventListener("click", async () => {
      const payload = {
        username: $("username").value.trim(),
        password: $("password").value,
        email: $("email").value.trim(),
        max: $("max").value.trim(),
        autorun: $("autorun").checked
      };

      if (!payload.username || !payload.password) {
        say("Please enter your username and password.", "err");
        return;
      }

      $("run").disabled = true;
      say("Starting your run…");

      try {
        const resp = await fetch("/run", {
          method: "POST",
          headers: { "Content-Type": "application/json", "Accept": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await resp.json();
        if (!resp.ok || !data?.ok) throw new Error(data?.error || "Failed to start run");

        // Redirect to your private live stream for this job
        window.location.assign(data.live);
      } catch (e) {
        say(e.message || String(e), "err");
        $("run").disabled = false;
      }
    });
  </script>
</body>
</html>
