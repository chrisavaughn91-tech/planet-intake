<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Planet Lead Pull — Start a Scrape</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* =========================================================
       THEME SYSTEM (3 presets) – no external CSS required
       Body carries one of: theme--modern (default), theme--neon, theme--matrix
       ========================================================= */
    :root{
      /* App tokens used by layout */
      --bg: #0e1116;
      --panel: #151a22;
      --border: #2a2f3a;
      --text: #e7eef7;
      --muted:#8b98a5;
      --chip:#2b3544;
      --accent:#6aa8ff;
      --ok:#7dffa0; --warn:#ffd27a; --err:#ff7d7d;
      --input:#111722;
      --shadow: 0 20px 50px rgba(0,0,0,.35);
    }
    /* Modern (dark/blue) */
    .theme--modern{
      --bg: #0d1118;
      --panel:#151a22; --border:#2b3441; --chip:#273141;
      --text:#e7eef7; --muted:#8b98a5; --accent:#6aa8ff;
      --input:#101722;
    }
    /* Neon (night-vision) */
    .theme--neon{
      --bg:#0a0f0a; --panel:#111911; --border:#2c3a2f; --chip:#162116;
      --text:#e8f3ea; --muted:#9aa69f; --accent:#8fffa0;
      --input:#0b120c;
      --shadow: 0 24px 60px rgba(0,0,0,.45);
    }
    /* Matrix (phosphor green) */
    .theme--matrix{
      --bg:#070907; --panel:#0e140f; --border:#18301e; --chip:#132016;
      --text:#e3ffe9; --muted:#95b39c; --accent:#00ff84;
      --input:#0b140d;
      --shadow: 0 24px 60px rgba(0,0,0,.5);
    }

    /* ====== Page layout (theme-driven) ====== */
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; padding:28px; display:grid; place-items:center;
      color:var(--text);
      background:
        radial-gradient(1000px 700px at 10% -10%, rgba(106,168,255,.06), transparent 60%),
        radial-gradient(900px 600px at 100% 120%, rgba(143,255,160,.05), transparent 60%),
        linear-gradient(180deg, var(--bg), #0b0e13 45%, var(--bg));
    }
    .card{
      width:100%; max-width:620px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:22px;
      box-shadow:var(--shadow);
    }
    h1{ margin:0 0 8px; font-size:22px; letter-spacing:.2px }
    .sub{ margin:0 0 14px; color:var(--muted) }

    .theme-picker{
      display:flex; gap:8px; align-items:center; margin:10px 0 18px;
      font-size:12px; color:var(--muted)
    }
    .theme-pill{
      padding:4px 10px; border-radius:999px; cursor:pointer; user-select:none;
      background:var(--chip); border:1px solid var(--border);
    }

    label{ display:block; font-size:13px; color:var(--muted); margin:10px 0 6px }
    input, select{
      width:100%; padding:10px 12px; font-size:14px; color:var(--text);
      background:var(--input); border:1px solid var(--border); border-radius:10px; outline:none;
    }
    input:focus, select:focus{ border-color:var(--accent); box-shadow:0 0 0 2px color-mix(in srgb, var(--accent) 25%, transparent) inset }

    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .actions{ display:flex; gap:12px; align-items:center; margin-top:16px }
    button{
      padding:10px 14px; border-radius:10px; border:1px solid var(--border);
      background:linear-gradient(180deg, color-mix(in srgb, var(--panel) 85%, #000 15%), var(--panel));
      color:var(--text); cursor:pointer; font-weight:600;
    }
    button:hover{ border-color:var(--accent) }
    .note{ font-size:12px; color:var(--muted) }
    .ok{ color:var(--ok)} .err{ color:var(--err)}
  </style>
</head>

<body class="theme--modern">
  <main class="card">
    <h1>Planet Lead Pull — Start a Scrape</h1>
    <p class="sub">Enter your credentials for this run. You’ll get a private live stream and your own sheet.</p>

    <!-- Theme picker -->
    <div class="theme-picker">
      Theme:
      <span class="theme-pill" data-theme="modern">Modern</span>
      <span class="theme-pill" data-theme="neon">Neon</span>
      <span class="theme-pill" data-theme="matrix">Matrix</span>
    </div>

    <form id="f" autocomplete="on">
      <label for="u">Username</label>
      <input id="u" autocomplete="username" required />

      <label for="p">Password</label>
      <input id="p" type="password" autocomplete="current-password" required />

      <label for="e">Report email (where the sheet is shared)</label>
      <input id="e" type="email" autocomplete="email" required />

      <div class="row">
        <div>
          <label for="m">Max leads (optional)</label>
          <input id="m" type="number" min="1" step="1" placeholder="blank = default" />
        </div>
        <div>
          <label for="s">Start immediately</label>
          <select id="s">
            <option value="true" selected>Yes</option>
            <option value="false">No (just open live)</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button type="submit">Start Run</button>
        <span id="status" class="note"></span>
      </div>
    </form>

    <div class="note" style="margin-top:10px">
      After submit, you’ll be redirected to your private <code>/live?job=…</code>.
    </div>
  </main>

  <script>
    // ---------- theme persistence ----------
    const THEME_KEY = 'plp_theme';
    const themeClass = {
      modern: 'theme--modern',
      neon: 'theme--neon',
      matrix: 'theme--matrix'
    };
    const applyTheme = (name) => {
      const body = document.body;
      body.classList.remove(...Object.values(themeClass));
      body.classList.add(themeClass[name] || themeClass.modern);
      localStorage.setItem(THEME_KEY, name);
    };
    applyTheme(localStorage.getItem(THEME_KEY) || 'modern');
    document.querySelectorAll('.theme-pill').forEach(p =>
      p.addEventListener('click', () => applyTheme(p.dataset.theme))
    );

    // ---------- existing login flow (unchanged) ----------
    const $ = s => document.querySelector(s);
    const status = $('#status');

    $('#f').addEventListener('submit', async (ev) => {
      ev.preventDefault();
      status.textContent = 'Creating job…';
      try {
        const payload = {
          username: $('#u').value.trim(),
          password: $('#p').value,
          email:    $('#e').value.trim(),
          max:      ($('#m').value || '').trim(),
          autoStart: $('#s').value === 'true'
        };

        const res = await fetch('/session', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(await res.text().catch(()=>('HTTP '+res.status)));
        const data = await res.json();
        const liveUrl = data.liveUrl || `/live?job=${encodeURIComponent(data.jobId)}`;

        status.innerHTML = '<span class="ok">Job created.</span> Opening live…';
        setTimeout(() => location.href = liveUrl, 350);
      } catch (err) {
        console.error(err);
        status.innerHTML = `<span class="err">Error:</span> ${err.message || err}`;
      }
    });
  </script>
</body>
</html>
