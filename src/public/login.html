<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Planet Lead Pull — Start a Scrape</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box }
    html, body { height: 100%; overflow-x: hidden; }
    body {
      margin: 0; padding: 28px; display: grid; place-items: center;
      font: 14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Inter, Roboto, Helvetica, Arial;
      color: var(--fg); background: var(--bg);
    }

    /* ===== match live.html (t-aurora) ===== */
    .t-aurora {
      --bg:#0b0f12; --panel: linear-gradient(180deg,#0e1317,#0b1014); --hdr-bg: rgba(11,15,18,.9);
      --fg:#e8eef6; --muted:#9fb0c2; --line:#1e2a34; --chip:#0f151b; --chip-b:#20303a; --input:#0e1419; --time:#b9c7d6;
      --c-info:#86b7ff; --c-start:#ffd27a; --c-lead:#a8ff8a; --c-num:#80ffc8; --c-badge:#f6b4ff; --c-sheet:#9ff2ff; --c-err:#ff7b7b; --c-done:#8ef0c9; --ok:#8fffa0;
    }
    .t-aurora::before { content:""; position:fixed; inset:0; pointer-events:none; mix-blend-mode:soft-light; opacity:.30;
      background: conic-gradient(from 0deg, rgba(80,180,255,.15), transparent 25%, rgba(120,255,170,.12), transparent 55%, rgba(255,220,120,.12), transparent 85%);
      filter: blur(22px); transform: scale(1.35); animation: neb 14s linear infinite;
    }
    @keyframes neb { to { transform: scale(1.35) rotate(360deg) } }

    /* ===== card ===== */
    .card{
      width:100%; max-width:640px;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:22px;
      box-shadow: 0 20px 50px rgba(0,0,0,.35);
      position: relative;
    }

    header{
      display:flex; align-items:center; gap:10px; margin-bottom:8px;
      padding-bottom:8px; border-bottom:1px solid var(--line);
    }
    .brand{ font-weight:800; letter-spacing:.4px }
    .sub{ margin:4px 0 14px; color:var(--muted) }

    label{ display:block; font-size:13px; color:var(--muted); margin:10px 0 6px }
    input{
      width:100%; padding:10px 12px; font-size:14px; color:var(--fg);
      background:var(--input); border:1px solid var(--chip-b); border-radius:10px; outline:none;
    }
    input:focus{ border-color: var(--c-info); box-shadow: 0 0 0 2px color-mix(in oklab, var(--c-info) 25%, transparent) inset }

    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .actions{ display:flex; gap:12px; align-items:center; margin-top:16px }
    button{
      padding:10px 14px; border-radius:10px; border:1px solid var(--chip-b);
      background:linear-gradient(180deg, color-mix(in oklab, var(--panel) 85%, #000 15%), var(--panel));
      color:var(--fg); cursor:pointer; font-weight:600;
    }
    button:hover{ border-color:var(--c-info) }
    .note{ font-size:12px; color:var(--muted) }
    .ok{ color:var(--ok)} .err{ color:var(--c-err)}

    .foot {
      margin-top: 14px; display:flex; justify-content:space-between; align-items:center; color:var(--muted);
    }
    .link { color: var(--c-sheet); text-decoration: none; border-bottom:1px dashed var(--c-sheet) }
    .link:hover { text-decoration: underline }
  </style>
</head>

<body class="t-aurora">
  <main class="card">
    <header>
      <div class="brand">OP: PLANET LEAD PULL</div>
      <div class="sub">Start a scrape</div>
    </header>

    <p class="sub">Enter credentials for this run. We’ll auto-start and take you to your private live stream.</p>

    <form id="f" autocomplete="on">
      <label for="u">Username</label>
      <input id="u" autocomplete="username" required />

      <label for="p">Password</label>
      <input id="p" type="password" autocomplete="current-password" required />

      <label for="e">Report email (where the sheet is shared)</label>
      <input id="e" type="email" autocomplete="email" required />

      <div class="row">
        <div>
          <label for="m">Max leads (optional)</label>
          <input id="m" type="number" min="1" step="1" placeholder="blank = default" />
        </div>
        <div></div>
      </div>

      <div class="actions">
        <button type="submit">Start Run</button>
        <span id="status" class="note"></span>
      </div>
    </form>

    <div class="foot">
      <span class="note">After submit, you’ll be redirected to <code>/live?job=…</code>.</span>
      <a class="link" href="/live" title="Open live without creating a new job">Open Live</a>
    </div>
  </main>

  <script>
    // ---------- login flow: always auto-start ----------
    const $ = s => document.querySelector(s);
    const status = $('#status');

    $('#f').addEventListener('submit', async (ev) => {
      ev.preventDefault();
      status.textContent = 'Creating job…';
      try {
        const payload = {
          username: $('#u').value.trim(),
          password: $('#p').value,
          email:    $('#e').value.trim(),
          max:      ($('#m').value || '').trim(),
          autoStart: true
        };

        const res = await fetch('/session', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(await res.text().catch(()=>('HTTP '+res.status)));
        const data = await res.json();
        const liveUrl = data.liveUrl || `/live?job=${encodeURIComponent(data.jobId)}`;

        status.innerHTML = '<span class="ok">Job created.</span> Opening live…';
        setTimeout(() => location.href = liveUrl, 350);
      } catch (err) {
        console.error(err);
        status.innerHTML = `<span class="err">Error:</span> ${err.message || err}`;
      }
    });
  </script>
</body>
</html>
